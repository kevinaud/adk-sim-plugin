[tool.uv.workspace]
members = ["server", "plugins/python", "packages/adk-sim-protos", "packages/adk-sim-testing"]

[tool.ruff]
target-version = "py314"
line-length = 88
indent-width = 2

[tool.ruff.lint]
select = [
    # --- Essentials ---
    "E",    # pycodestyle (standard python style errors)
    "F",    # Pyflakes (finds logical errors, unused variables/imports)
    "I",    # isort (sorts imports automatically)
    
    # --- Modernization ---
    "UP",   # pyupgrade (upgrades syntax to modern Python 3.14 standards)
    "FURB", # Refurb (modernizes and refactors code using newer stdlib features)
    
    # --- Code Quality & Logic ---
    "SIM",  # flake8-simplify (suggests logical simplifications)
    "B",    # flake8-bugbear (finds likely bugs and design problems)
    "C4",   # flake8-comprehensions (improves list/dict/set comprehensions)
    "RET",  # flake8-return (checks for unnecessary return logic/branching)
    "RUF",  # Ruff-specific rules (ambiguous characters, static keys, etc.)
    
    # --- Specific Enforcements ---
    "TC",   # flake8-type-checking (moves imports to 'if TYPE_CHECKING' blocks)
    "TID",  # flake8-tidy-imports (we use this to ban __future__ and old typing)
    
    # --- Safety & Async ---
    "ASYNC", # flake8-async (prevents blocking calls in async functions)
    "DTZ",   # flake8-datetimez (bans naive datetimes to prevent timezone bugs)
    "PERF",  # Perflint (checks for performance anti-patterns)
    
    # --- Testing ---
    "PT",    # flake8-pytest-style (enforces consistent pytest fixture/assert style)
]

[tool.ruff.lint.per-file-ignores]
# IGNORE generated files for all these new strict rules
"packages/adk-sim-protos/**" = [
    "E501",
    "UP",
    "TC",
    "TID",
    "B",
    "SIM",
    "RUF",
    "FURB",
    "ASYNC",
    "PT",
    "RET",
    "DTZ",
]
"adk_agent_sim/generated/**" = [
    "E501",
    "UP",
    "TC",
    "TID",
    "B",
    "SIM",
    "RUF",
    "FURB",
    "ASYNC",
    "PT",
    "RET",
    "DTZ",
]
"adk_agent_sim/generated_check_tmp/**" = [
    "E501",
    "UP",
    "TC",
    "TID",
    "B",
    "SIM",
    "RUF",
    "FURB",
    "ASYNC",
    "PT",
    "RET",
    "DTZ",
]

# Common test-specific ignores
# S101: "Use of assert detected" (flake8-bandit) - asserts are normal in tests
"tests/**" = ["S101"] 

[tool.ruff.lint.flake8-tidy-imports.banned-api]
"__future__.annotations".msg = "Python 3.14+ deferred evaluation is standard. Do not use future import."
"typing.List".msg = "Use builtin `list` instead."
"typing.Dict".msg = "Use builtin `dict` instead."
"typing.Tuple".msg = "Use builtin `tuple` instead."
"typing.Union".msg = "Use `|` operator instead."
"typing.Optional".msg = "Use `X | None` instead."

[tool.ruff.lint.flake8-type-checking]
strict = true

[tool.ruff.lint.flake8-pytest-style]
fixture-parentheses = false
mark-parentheses = false

[tool.pyright]
pythonVersion = "3.14"
typeCheckingMode = "strict"
useLibraryCodeForTypes = true
exclude = ["**/generated/**", "packages/adk-sim-protos/**", "**/generated_check_tmp/**", "**/node_modules/**", "frontend/**", "**/.venv/**"]
reportPrivateImportUsage = false
reportMissingTypeStubs = false
reportUnknownParameterType = false
reportUnknownVariableType = false
reportUnknownArgumentType = false
reportUnknownLambdaType = false
reportUnknownMemberType = false
reportMissingTypeArgument = false
reportAttributeAccessIssue = false
reportArgumentType = false
reportPrivateUsage = false
reportRedeclaration = false
reportUnusedClass = false

[tool.pytest.ini_options]
testpaths = ["tests"]
asyncio_mode = "auto"
markers = [
    "integration: marks tests as integration tests (require API keys, slower)",
]
filterwarnings = [
    "ignore::DeprecationWarning",
]
