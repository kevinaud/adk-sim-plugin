services:
  backend:
    build:
      context: .
      dockerfile: docker/backend.Dockerfile
    ports:
      - "50051:50051"
      - "8080:8080"
    volumes:
      - ./server/src/adk_sim_server:/app/server/src/adk_sim_server:cached
      - ./plugins/python:/app/plugins/python:cached
      - ./packages:/app/packages:cached
      - ./logs:/app/logs
      - backend-data:/app/data
    environment:
      - PYTHONPATH=/app
      - LOG_LEVEL=INFO
      - LOG_FILE=/app/logs/coordination-service.log
      # Override default to use the mounted volume path
      - ADK_AGENT_SIM_DATABASE_URL=sqlite+aiosqlite:////app/data/simulator.db
    command: uv run adk-sim

  frontend:
    build:
      context: .
      dockerfile: docker/frontend.Dockerfile
    ports:
      - "4200:4200"
    volumes:
      - ./frontend:/app/frontend:cached
      - /app/frontend/node_modules
      - ./packages/adk-sim-protos-ts:/app/packages/adk-sim-protos-ts:cached
    working_dir: /app/frontend
    command: npx ng serve --host 0.0.0.0 --poll 2000

volumes:
  backend-data:

